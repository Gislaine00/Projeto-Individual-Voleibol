<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora do Vôlei | Quiz</title>
    <link rel="icon" href="./assets/imgs/logoVolei.png" type="image/png">
    <link rel="stylesheet" href="./css/styleQuiz.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="logo">
        <img id="idLogo" src="./assets/imgs/logoVolei.png" alt="logo" class="logo-img">
        <p class="nomeProjeto">Hora do Vôlei</p>
    </div>

    <div class="divSeta">
        <img onclick="voltar()" class="imgSeta" src="./assets/imgs/icons/setaEsquerdaBranco.png">
    </div>

    <div class="container" id="container">

        <h1 style="margin: auto; text-align: center; text-decoration: underline;">Quiz</h1>
        <div class="divPergunta" id="divPergunta1">
            <p><span class="corNumV">1-</span> Em que país foi criado o voleibol?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa1" id="alternativa" value="1" name="resposta1">Alemanha<br>
                <input type="radio" class="alternativa1" id="alternativa" value="2" name="resposta1">Brasil<br>
                <input type="radio" class="alternativa1" id="alternativa" value="3" name="resposta1">França<br>
                <input type="radio" class="alternativa1" id="alternativa" value="4" name="resposta1">Estados Unidos<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta2">
            <p><span class="corNumA">2-</span> Qual o tamanho da quadra de vôlei?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA2" value="1" name="resposta2">15x9<br>
                <input type="radio" class="alternativa" id="alternativaB2" value="2" name="resposta2">18x9<br>
                <input type="radio" class="alternativa" id="alternativaC2" value="3" name="resposta2">15x6<br>
                <input type="radio" class="alternativa" id="alternativaD2" value="4" name="resposta2">18x6<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta3">
            <p><span class="corNumV">3-</span> Quando é comemorado oficialmente o dia nacional do voleibol?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA3" value="1" name="resposta3">30 agosto<br>
                <input type="radio" class="alternativa" id="alternativaB3" value="2" name="resposta3">27 de agosto<br>
                <input type="radio" class="alternativa" id="alternativaC3" value="3" name="resposta3">27 de junho<br>
                <input type="radio" class="alternativa" id="alternativaD3" value="4" name="resposta3">30 de junho<br>
            </div>
            </div>
        
        <div class="divPergunta" id="divPergunta4">
            <p><span class="corNumA">4-</span> Em quantas Olimpíadas consecutivas a Seleção Masculina de Vôlei conquistou medalhas?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA4" value="1" name="resposta4">2<br>
                <input type="radio" class="alternativa" id="alternativaB4" value="2" name="resposta4">3<br>
                <input type="radio" class="alternativa" id="alternativaC4" value="3" name="resposta4">4<br>
                <input type="radio" class="alternativa" id="alternativaD4" value="4" name="resposta4">5<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta5">
            <p><span class="corNumV">5-</span> Quem é a jogadora brasileira com mais participações em Olimpíadas pela Seleção Feminina?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA5" value="1" name="resposta5">Fofão<br>
                <input type="radio" class="alternativa" id="alternativaB5" value="2" name="resposta5">Fabiana Claudino<br>
                <input type="radio" class="alternativa" id="alternativaC5" value="3" name="resposta5">Sheilla<br>
                <input type="radio" class="alternativa" id="alternativaD5" value="4" name="resposta5">Jaqueline<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta6">
            <p><span class="corNumA">6-</span> Qual o atual técnico do vôlei masculino?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA5" value="1" name="resposta6">Antônio Carlos Zigotto<br>
                <input type="radio" class="alternativa" id="alternativaB5" value="2" name="resposta6">Luísa Machado Kopp<br>
                <input type="radio" class="alternativa" id="alternativaC5" value="3" name="resposta6">Bernadinho<br>
                <input type="radio" class="alternativa" id="alternativaD5" value="4" name="resposta6">Renan Dal Zotto<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta7">
            <p><span class="corNumV">7-</span> Qual o atual técnico do vôlei feminino?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA5" value="1" name="resposta7">Renan Dal Zotto<br>
                <input type="radio" class="alternativa" id="alternativaB5" value="2" name="resposta7">Bernadinho<br>
                <input type="radio" class="alternativa" id="alternativaC5" value="3" name="resposta7">José Roberto Guimarães<br>
                <input type="radio" class="alternativa" id="alternativaD5" value="4" name="resposta7"> Jaqueline Silva<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta8">
            <p><span class="corNumA">8-</span> Quantas substituições uma equipe pode fazer durante um set em uma partida de vôlei?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA5" value="1" name="resposta8">Duas<br>
                <input type="radio" class="alternativa" id="alternativaB5" value="2" name="resposta8">Quatro<br>
                <input type="radio" class="alternativa" id="alternativaC5" value="3" name="resposta8">Cinco<br>
                <input type="radio" class="alternativa" id="alternativaD5" value="4" name="resposta8">Três<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta9">
            <p><span class="corNumV">9-</span> Se a bola toca na linha da quadra durante uma jogada, qual é a decisão do árbitro?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA5" value="1" name="resposta9">A bola é considerada dentro<br>
                <input type="radio" class="alternativa" id="alternativaB5" value="2" name="resposta9">Manda refazer a jogada<br>
                <input type="radio" class="alternativa" id="alternativaC5" value="3" name="resposta9">Sempre considera fora<br>
                <input type="radio" class="alternativa" id="alternativaD5" value="4" name="resposta9">Depende da opinião dos jogadores<br>
            </div>
        </div>

        <div class="divPergunta" id="divPergunta10">
            <p><span class="corNumA">10-</span>  Em que ano a seleção brasileira de vôlei feminino conquistou seu primeiro título no Campeonato Mundial?</p>
            <div class="divRadios">
                <input type="radio" class="alternativa" id="alternativaA5" value="1" name="resposta10">1994<br>
                <input type="radio" class="alternativa" id="alternativaB5" value="2" name="resposta10">1998<br>
                <input type="radio" class="alternativa" id="alternativaC5" value="3" name="resposta10">2002<br>
                <input type="radio" class="alternativa" id="alternativaD5" value="4" name="resposta10">2006<br>
            </div>
        </div>

            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 15px; margin-top: 10px;">
                <button onclick="finalizar()" class="btnFinalizar">Finalizar</button>
                <button onclick="tentar()" class="btnTentar">Tente novamente</button>
            </div>


                <div class="ExGrafico"> 
                    <div id="exibir" class="exibir"></div>
                
                    <div style="border: 2px solid white; width: 40vh; height: 40vh;">
                        <canvas id="myChart" style="display: flex; width: 40vw; height: 40vh;"></canvas>
                    </div>
                    <hr id="hrVertical" style="display: none; margin-left: 5px;">
                   
                    <div id="exibir1">
                        <h1 id="idH1" style="display: none; font-size: 20px; text-align: center;">Ranking de Pontuações(%)</h1>
                        <div>
                            <canvas id="myChartBarra" style="width: 30vw; height: 40vh;"></canvas>
                          </div>
                    </div>
                </div>
</div>

</body>
</html>

<script> 
    function voltar(){
        window.location.href = "interno.html"
    }
    
    function finalizar() {
    var listaAcertos = 0;
    var listaErros = 0;

    var opcoes1 = document.getElementsByName('resposta1');
    var opcoes2 = document.getElementsByName('resposta2');
    var opcoes3 = document.getElementsByName('resposta3');
    var opcoes4 = document.getElementsByName('resposta4');
    var opcoes5 = document.getElementsByName('resposta5');
    var opcoes6 = document.getElementsByName('resposta6');
    var opcoes7 = document.getElementsByName('resposta7');
    var opcoes8 = document.getElementsByName('resposta8');
    var opcoes9 = document.getElementsByName('resposta9');
    var opcoes10 = document.getElementsByName('resposta10');


    var opcoes = [].concat(Array.from(opcoes1), Array.from(opcoes2), Array.from(opcoes3), Array.from(opcoes4), Array.from(opcoes5), Array.from(opcoes6), Array.from(opcoes7),Array.from(opcoes8), Array.from(opcoes9), Array.from(opcoes10));

   
    var listaPerguntasCertas=[];
    var listaPerguntasErradas = [];

        for (var i = 0; i < opcoes.length; i++) {
            if (opcoes[i].checked) {
                var alternativaSelecionada = parseInt(opcoes[i].value);

                if (opcoes[i].name === 'resposta1') {
                    if (alternativaSelecionada === 4) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(1);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(1);
                    }
                } else if (opcoes[i].name === 'resposta2') {
                    if (alternativaSelecionada === 2) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(2);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(2);
                    }
                } else if (opcoes[i].name === 'resposta3') {
                    if (alternativaSelecionada === 3) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(3);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(3);
                    }
                } else if (opcoes[i].name === 'resposta4') {
                    if (alternativaSelecionada === 3) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(4);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(4);
                    }
                } else if (opcoes[i].name === 'resposta5') {
                    if (alternativaSelecionada === 1) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(5);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(5);
                    }
                } else if (opcoes[i].name === 'resposta6') {
                    if (alternativaSelecionada === 4) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(6);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(6);
                    }
                } else if (opcoes[i].name === 'resposta7') {
                    if (alternativaSelecionada === 3) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(7);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(7);
                    }
                } else if (opcoes[i].name === 'resposta8') {
                    if (alternativaSelecionada === 2) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(8);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(8);
                    }
                } else if (opcoes[i].name === 'resposta9') {
                    if (alternativaSelecionada === 1) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(9);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(9);
                    }
                } else if (opcoes[i].name === 'resposta10') {
                    if (alternativaSelecionada === 2) {
                        listaAcertos += 1;
                        listaPerguntasCertas.push(10);
                    } else {
                        listaErros += 1;
                        listaPerguntasErradas.push(10);
                    }
                }
                
            }   

            var analise= ""

            if(listaAcertos <= 4){
                exibir.innerHTML = `<b>${analise = "vishh, você não conhece muito sobre vôlei"}</b><br>`
            }else if(listaAcertos <=7){
                exibir.innerHTML = `<b>${analise ="Você já sabe muita coisa, mas pode melhorar"}</b><br>`
            }else{
                exibir.innerHTML = `<b>${analise = "Muito bem, você sabe muito. Parabéns"}</b><br>`
            }
        }
        
        var calculoAcertos = listaAcertos/10*100;
        var calculoErros = listaErros/10*100;
        exibir.innerHTML += `<u>Acertos:</u> ${calculoAcertos}% <br><u>Erros:</u>${calculoErros}%<br>
            <span style="color:#32CD32">Perguntas que acertou: ${listaPerguntasCertas}</span><br> <span style="color:red">Perguntas que errou: ${listaPerguntasErradas}</span>`;

        
            /* grafico */
        const ctx = document.getElementById('myChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Acertos', 'Erros'],
                datasets: [{
                    data: [calculoAcertos, calculoErros],
                    borderWidth: 2,
                    borderColor: ['black'],
                    backgroundColor: ['#00FF7F', 'red'],
                }]
            },
            options: {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += context.parsed + '%';
                                return label;
                            }
                        }
                    }
                }
            }
        });

        desativarRadios();

        document.getElementById('hrVertical').style.display = 'block';
        document.getElementById('idH1').style.display = 'block';

        var listaRanking = [];
        var ranking = JSON.parse(sessionStorage.QUIZ);
        for(var i = 0; i < ranking.length; i++){
            listaRanking.push(ranking[i].pontuacaoAcertos); 
       
        }

        const ctx2 = document.getElementById('myChartBarra').getContext('2d');

        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ['1° lugar', '2° lugar', '3° lugar', '4° lugar', '5° lugar'],
                datasets: [{
                    data: listaRanking,
                    borderWidth: 1,
                    borderColor: 'black',
                    backgroundColor: ['#00FF7F', 'red', 'pink', 'orange', 'purple'],
                    label: 'Pontuação',
                }],
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                    },
                },
                plugins: {
                    legend: {
                        display: false,
                    },
                },
                indexAxis: 'y',
            },
        });


    var idUsuario = sessionStorage.ID_USUARIO;
    fetch("/quiz/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        idServer: idUsuario,
        acertosServer: listaAcertos,
        errosServer: listaErros
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            console.log("ta indo");
 
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);

      });

    return false;
        
    
}



function desativarRadios() {
    const radios = document.querySelectorAll('input[type="radio"]');
    radios.forEach(radio => {
        radio.disabled = true;
    });
}

function tentar() {
    location.reload();
}


</script>

   
    
        